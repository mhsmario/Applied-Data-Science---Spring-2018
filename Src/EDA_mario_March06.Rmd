---
title: "EDA_March06"
author: "Mario Saraiva"
date: "3/6/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
##Libraries

##If not working on your own machine use this code to speed up the setup:

#install.packages(c("corrplot", "shiny", "dplyr", "ggplot2", "e1071", "glmnet", "mice", "lattice", "VIM", "stargazer", "RColorBrewer", "ggfortify", "gam", "caret", "flam", "bartMachine", "tree", "ISLR", "ggfortify", "purr", "tidyr", "RColorBrewer", "readr"))

library(glmnet)
library(purrr)
library(tidyr)
library(readr)
library(corrplot)
library(shiny)
library(dplyr)
library(ggplot2)
library(e1071)
library(glmnet)
library(mice)
library(lattice)
library(VIM)
library(caret)
library(stargazer)
library(gam)
library(flam)
#options(java.parameters = "-Xmx5g") #useful when bartmachine breaks because of Java on IOS
library(bartMachine)
library(tree)
library(ISLR)
library(RColorBrewer)
library(ggfortify)
library(scales)
library(stargazer)
```

#Load Data
```{r}
train <- read.csv('train.csv')
#test <- read.csv('/Users/lizhizicui/Desktop/Dataset/Kaggle House Price/test.csv')
```


##There are 1460 instances of training data and 1460 of test data. Total number of attributes equals 81, of which 36 is quantitative, 43 categorical + Id and SalePrice.##

Quantitative: 1stFlrSF, 2ndFlrSF, 3SsnPorch, BedroomAbvGr, BsmtFinSF1, BsmtFinSF2, BsmtFullBath, BsmtHalfBath, BsmtUnfSF, EnclosedPorch, Fireplaces, FullBath, GarageArea, GarageCars, GarageYrBlt, GrLivArea, HalfBath, KitchenAbvGr, LotArea, LotFrontage, LowQualFinSF, MSSubClass, MasVnrArea, MiscVal, MoSold, OpenPorchSF, OverallCond, OverallQual, PoolArea, ScreenPorch, TotRmsAbvGrd, TotalBsmtSF, WoodDeckSF, YearBuilt, YearRemodAdd, YrSold

Qualitative: Alley, BldgType, BsmtCond, BsmtExposure, BsmtFinType1, BsmtFinType2, BsmtQual, CentralAir, Condition1, Condition2, Electrical, ExterCond, ExterQual, Exterior1st, Exterior2nd, Fence, FireplaceQu, Foundation, Functional, GarageCond, GarageFinish, GarageQual, GarageType, Heating, HeatingQC, HouseStyle, KitchenQual, LandContour, LandSlope, LotConfig, LotShape, MSZoning, MasVnrType, MiscFeature, Neighborhood, PavedDrive, PoolQC, RoofMatl, RoofStyle, SaleCondition, SaleType, Street, Utilities,

```{R, EDA}

# summary(train)
# summary(test)
hist(train$SalePrice, breaks=seq(30000, 760000, 500),prob=TRUE )
lines(density(train$SalePrice), col="blue", lwd=2)       
lines(density(train$SalePrice, adjust=2), lty="dotted")

hist(train$SalePrice, breaks=seq(30000, 760000, 2000),prob=TRUE )
lines(density(train$SalePrice), col="blue", lwd=2)       
# indicate not a standard normal distribution

# Log the SalePrice, the distribution of log(SalePrice) looks like a normal distribution
train$log_saleprice <- log(train$SalePrice)
train$log_saleprice
hist(train$log_saleprice, breaks=seq(10, 14, 0.025),prob=TRUE )
lines(density(train$log_saleprice), col="blue", lwd=2)      

is.factor(train$Electrical)

qt <- train %>% keep(is.numeric)
ql <- train %>% keep(is.factor)

hist(train$log_saleprice,prob=TRUE )
lines(density(train$log_saleprice), col="blue", lwd=2) 

boxplot(SalePrice~BldgType,data=train, main="SalePrince vs Type of dwelling", 
  	xlab="Type of dwelling", ylab="SalePrince")

# corrplot(cor(qt), diag = FALSE, method = "number")

col <- brewer.pal(4,"RdYlBu") #selecting color palette

#corrplot(cor(qt, use = "complete.obs"), col = col, tl.cex = 0.6, number.cex = .6, title = "Correlation between (numeric) Variables", type = "upper", mar = c(1,0,1,0), diag = FALSE, method = "square")

```


##Distribution of our quantitative variables
```{r}

qtc <- na.omit(qt)

### Shiny uses only numerical variables.
shinyApp(
  ui = fillPage(
    fillCol(flex = c(NA, 1),
            inputPanel(
              selectInput("xcol", label = "X-axis:", 
                          names(qtc))
            ),
            plotOutput("plot", height = "100%")
    )
  ),
  server = function(input, output) {
    output$plot = renderPlot( {
      par(mfrow=c(1,1))
      plot(density(qtc[,input$xcol]), main="Distribution of Quantitative variables", sub=paste("Skewness:", round(e1071::skewness(qtc[,input$xcol]), 2)))
      polygon(density(qtc[,input$xcol]), col="light blue") }
    )},
  options = list(height = 700)
)

```


##Explore missing values

```{r, warning=FALSE, message=FALSE}
na_count <-sapply(train, function(y) sum(length(which(is.na(y)))))
na_count <- data.frame(na_count)

# maping_nas <- aggr(train, plot = FALSE, col = c('navyblue','red'), numbers = TRUE, sortVars = TRUE, labels = names(train), prop = FALSE)
# 
# sumnas <- as.matrix(summary(train))
# 
# plot_nas <- aggr(train, plot = TRUE, col =  c('navyblue','lightblue'), numbers = TRUE, sortVars = TRUE, labels = names(train), cex.axis = .5, gap = 1, ylab = c("Histogram of missing data","Pattern"), prop = TRUE, digits = "2")
```

Most missing: "PoolQC", "MiscFeature", "Alley", "Fence", "FireplaceQu", "LotFrontage"

Variable | Count of Missing
---------|-----------------
PoolQC | 1453
MiscFeature | 1406
Alley | 1369
Fence | 1179
FireplaceQu | 690
LotFrontage | 259
GarageType | 81
GarageYrBlt | 81
GarageFinish | 81
GarageQual81
GarageCond | 81
BsmtExposur | 38
BsmtFinType2 | 38
BsmtQual | 37
BsmtCond | 37
BsmtFinType1 | 37
MasVnrType | 8


```{r}

drop.na.columns <- c("PoolQC", "MiscFeature", "Alley", "Fence", "FireplaceQu", "LotFrontage")

ql.minus.nas <- ql[ , !(names(ql) %in% drop.na.columns)]

qlc <- na.omit(ql.minus.nas)

```

```{r}
#Exploring the data through different graphs

##UNDER CONSTRUCTION

#Shinny #2
shinyApp( 
  
ui <- fluidPage(    
  
  # Give the page a title
  titlePanel("Categorical variables"),
  
  # Generate a row with a sidebar
  sidebarLayout(      
    
    # Define the sidebar with one input
    sidebarPanel(
      selectInput("Categorical Variable", "Region:", 
                  choices=colnames(qlc)),
      hr(),
      helpText("Data from House Sales - Kaggle.")
    ),
    
    # Create a spot for the barplot
    mainPanel(
      plotOutput("phonePlot")  
    )
   ),

server = # Define a server for the Shiny app
function(input, output) {
  
  # Fill in the spot we created for a plot
  output$phonePlot <- renderPlot({
    
    # Render a barplot
    barplot(qlc[,input$region]*1000, 
            main=input$region,
            ylab="Number of Telephones",
            xlab="Year")
  })
}
 )
)  
```

